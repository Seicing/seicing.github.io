<!DOCTYPE html>
<html style="height:100%;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://seicing.com/res/favicon.ico" />
    <script language="javascript" src="https://seicing.com/js/defaultall.js"></script>
    <script language="javascript" src="https://seicing.com/js/sheetcore.js"></script>
    <link href="https://seicing.com/css/style_headless.css" rel="stylesheet" type="text/css" media="screen" /> 
<title>剑魂</title>
<link href="https://seicing.com/css/table.css" rel="stylesheet" type="text/css" media="screen" />
<link href="https://seicing.com/css/link.css" rel="stylesheet" type="text/css" media="screen" />
<style>
    .skill {
        border: 1px solid #444;
        background: #2b2b2b;
        padding: 15px;
        margin-bottom: 14px;
        border-radius: 6px;
    }

    .title {
        display: flex;
        align-items: center;
        font-size: 18px;
        font-weight: bold;
        color: #ffd166;
    }

    .divider {
        height: 1px;
        background: #444;
        margin: 8px 0;
    }

    .meta {
        color: #aaa;
        margin-bottom: 6px;
    }

    .desc {
        white-space: pre-line;
        margin-bottom: 6px;
    }

    .level-box {
        background: #1a1a1a;
        padding: 8px;
        border-radius: 4px;
        font-size: 13px;
        color: #ccc;
    }
</style>
</head>

<body style="height:100%;" id='scroll-2'>
    <button id="sidebar-toggle-button">☰</button>
    <button id="back-to-top-button">▲</button>
    <div id="sidebar-overlay"></div>
    <div id="wrapper" style="height:auto;width:1280px ; margin:auto">
        <div id="wrapper2" style="height:auto;">
            <div id="page" style="height:100%;">
                <div id="content">
                    <div class="post">
                        <div style="clear: both;">&nbsp;</div>
                        <div class="entry"><div>
    <div id="app">

        <div v-for="skill in skills" :id="'skill-'+skill.skillId" class="skill">

            <div class="title">
                <img :src="skill.icon" class="icon">
                {{ skill.name }}
            </div>

            <!-- 等级控制 -->
            <div class="lvbox">
                <button @click="changeLv(skill,-1)">-</button>
                Lv.{{ skill.lv }}
                <button @click="changeLv(skill,1)">+</button>
            </div>

            <div class="meta">
                施放: {{ skill.current.castingTime ?? '瞬发' }} |
                CD: {{ skill.current.coolTime }} |
                MP: {{ skill.current.consumeMp }}
            </div>

            <div class="desc">{{ skill.desc }}</div>

            <div class="meta">
                {{ skill.current.levelDesc }}
            </div>

        </div>

    </div>
</div>

                        </div>
                    </div>
                </div>
                <div id="sidebar" style="position:fixed; height:100%; width:220px">
                    <div id='scroll-1'
                        style="position:relative; left:-30px; height:90%; overflow-x:hidden; overflow-y:auto;">
                        <a href="https://seicing.com/html/dnfclass/剑魂.html"><b>回到职业页面</b></a><br><br>

                    </div>
                </div>
                <div style="clear: both;">&nbsp;</div>
                <div style="float:right; width:850px; text-align:right; border-top: 1px dashed #CACACA;"><br>
                    
<a href="https://seicing.com/html/dnfclass/剑魂.html"><b>回到职业页面</b></a>
                </div>
                <div style="clear: both;">&nbsp;</div>
            </div>

        </div>
    </div>

</body>


<script language="javascript" src="https://seicing.com/js/skill.js"></script>
<script language="javascript" src="https://seicing.com/js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="https://seicing.com/js/vue3.js"></script>
<script language="javascript" src="https://seicing.com/js/imgauto.js"></script>

<script>
    const { createApp } = Vue

    createApp({

        data() {
            return {
                jobId: "swordman_male",
                jobGrowId: "weapon_master",
                skills: []
            }
        },

        mounted() {
            this.init()
        },

        methods: {

            async init() {
                const list = await fetch("./skills.json").then(r => r.json())

                const ids = [...new Set(
                    list.filter(s => s.jobId === this.jobId && s.jobGrowId === this.jobGrowId)
                        .map(s => s.skillId)
                )]

                const reqs = ids.map(id =>
                    fetch(`https://api.dnftools.com/open/${this.jobId}/${this.jobGrowId}/${id}/`)
                        .then(r => r.json())
                        .then(j => this.normalize(id, j.data))
                )

                this.skills = await Promise.all(reqs)

                this.buildSidebar()
            },

            normalize(skillId, data) {

                const rows = data.levelInfo?.rows || []

                const icon = `https://data.seicing.com/seicingdepot/dfclass/characters/${this.jobId}/${this.jobGrowId}/skill/${skillId}.png`

                const skill = {
                    skillId,
                    name: data.name,
                    desc: data.desc,
                    icon,
                    rows,
                    lv: 1,
                    current: {}
                }

                this.applyLv(skill)
                return skill
            },

            applyLv(skill) {
                const row = skill.rows[skill.lv - 1] || {}
                const opt = row.optionValue || {}
                let text = skill.rows?.length
                    ? (skill.rows[0].optionDesc || "")
                    : ""

                if (text) {
                    text = skill.rows[0].optionDesc
                    for (const k in opt) {
                        text = text.replace(`{${k}}`, opt[k])
                    }
                }

                skill.current = {
                    castingTime: row.castingTime,
                    coolTime: row.coolTime,
                    consumeMp: row.consumeMp,
                    levelDesc: text
                }
            },

            changeLv(skill, delta) {
                const next = skill.lv + delta
                if (next < 1 || next > skill.rows.length) return
                skill.lv = next
                this.applyLv(skill)
            },

            /* ⭐ 生成 sidebar */
            buildSidebar() {
                const root = document.getElementById("sidebar")
                if (!root) return

                let container = root.querySelector("#scroll-1")
                if (!container) {
                    container = document.createElement("div")
                    container.id = "scroll-1"
                    root.appendChild(container)
                }

                const frag = document.createDocumentFragment()

                this.skills.forEach(s => {
                    const item = document.createElement("div")
                    item.className = "side-item"
                    item.textContent = s.name

                    item.onclick = () => {
                        document.getElementById("skill-" + s.skillId)
                            ?.scrollIntoView({ behavior: "smooth" })
                    }

                    frag.appendChild(item)
                })

                container.innerHTML = ""
                container.appendChild(frag)
            }

        }

    }).mount("#app")
</script>

</html>