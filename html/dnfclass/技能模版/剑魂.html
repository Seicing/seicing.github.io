<!DOCTYPE html>
<html style="height:100%;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://seicing.com/res/favicon.ico" />
    <script language="javascript" src="https://seicing.com/js/defaultall.js"></script>
    <script language="javascript" src="https://seicing.com/js/sheetcore.js"></script>
    <link href="https://seicing.com/css/style_headless.css" rel="stylesheet" type="text/css" media="screen" /> 
<title>剑魂</title>
<link href="https://seicing.com/css/table.css" rel="stylesheet" type="text/css" media="screen" />
<link href="https://seicing.com/css/link.css" rel="stylesheet" type="text/css" media="screen" />
<style>
    .skill {
        border: 1px solid #444;
        background: #2b2b2b;
        padding: 15px;
        margin-bottom: 14px;
        border-radius: 6px;
    }

    .title {
        display: flex;
        align-items: center;
        font-size: 18px;
        font-weight: bold;
        color: #ffd166;
    }

    .divider {
        height: 1px;
        background: #444;
        margin: 8px 0;
    }

    .meta {
        color: #aaa;
        margin-bottom: 6px;
    }

    .desc {
        white-space: pre-line;
        margin-bottom: 6px;
    }

    .level-box {
        background: #1a1a1a;
        padding: 8px;
        border-radius: 4px;
        font-size: 13px;
        color: #ccc;
    }
</style>
</head>

<body style="height:100%;" id='scroll-2'>
    <button id="sidebar-toggle-button">☰</button>
    <button id="back-to-top-button">▲</button>
    <div id="sidebar-overlay"></div>
    <div id="wrapper" style="height:auto;width:1280px ; margin:auto">
        <div id="wrapper2" style="height:auto;">
            <div id="page" style="height:100%;">
                <div id="content">
                    <div class="post">
                        <div style="clear: both;">&nbsp;</div>
                        <div class="entry"><div>
    <div id="app">
        <div v-for="skill in skills" :key="skill.skillId" class="skill">

            <!-- 标题 + 图标 -->
            <div class="title">
                <img :src="skill.icon" class="icon">
                {{ skill.name }}
            </div>

            <div class="divider"></div>

            <!-- 等级信息 -->
            <div class="meta">
                需求等级: {{ skill.requiredLevel }}
                （每 {{ skill.requiredLevelRange }} 级提升）
                | 最大等级: {{ skill.maxLevel }}
            </div>

            <!-- 施放/冷却/MP -->
            <div class="meta">
                施放: {{ skill.castingTime ?? '瞬发' }} |
                冷却: {{ skill.coolTime }}s |
                MP: {{ skill.consumeMp }}
            </div>

            <!-- 描述 -->
            <div class="desc">
                {{ skill.desc }}
            </div>

            <!-- 等级数据 -->
            <div class="level-box">
                Lv.1 数据：<br>
                {{ skill.levelDesc }}
            </div>

        </div>

    </div>
</div>

                        </div>
                    </div>
                </div>
                <div id="sidebar" style="position:fixed; height:100%; width:220px">
                    <div id='scroll-1'
                        style="position:relative; left:-30px; height:90%; overflow-x:hidden; overflow-y:auto;">
                        <a href="https://seicing.com/html/dnfclass/剑魂.html"><b>回到职业页面</b></a><br><br>

                    </div>
                </div>
                <div style="clear: both;">&nbsp;</div>
                <div style="float:right; width:850px; text-align:right; border-top: 1px dashed #CACACA;"><br>
                    
<a href="https://seicing.com/html/dnfclass/剑魂.html"><b>回到职业页面</b></a>
                </div>
                <div style="clear: both;">&nbsp;</div>
            </div>

        </div>
    </div>

</body>


<script language="javascript" src="https://seicing.com/js/skill.js"></script>
<script language="javascript" src="https://seicing.com/js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="https://seicing.com/js/vue3.js"></script>
<script language="javascript" src="https://seicing.com/js/imgauto.js"></script>

<script>
    const { createApp } = Vue

    createApp({

        data() {
            return {

                // ⭐ 每职业页面固定写死
                jobId: "swordman_male",
                jobGrowId: "weapon_master",
                jobGrowName: "极诣·剑魂",

                skills: []
            }
        },

        mounted() {
            this.loadSkills()
        },

        methods: {

            async loadSkills() {

                // 1️⃣ 加载总列表
                const list = await fetch("https://seicing.com/js/dnfskills.json")
                    .then(r => r.json())

                // 2️⃣ 筛选当前转职技能
                const filtered = list.filter(s =>
                    s.jobId === this.jobId &&
                    s.jobGrowId === this.jobGrowId
                )

                // 去重 skillId
                const uniqueSkillIds = [...new Set(filtered.map(s => s.skillId))]

                // 3️⃣ 并发请求技能详情
                const requests = uniqueSkillIds.map(id =>
                    fetch(`https://api.dnftools.com/open/${this.jobId}/${this.jobGrowId}/${id}/`)
                        .then(r => r.json())
                        .then(json => this.normalizeSkill(id, json.data))
                )

                this.skills = await Promise.all(requests)
            },

            normalizeSkill(skillId, data) {

                const base = data.levelInfo?.rows?.[0] || {}

                // ⭐ 保留 https://seicing.com/res/
                const icon =
                    `https://image.dnftools.com/characters/${this.jobId}/${this.jobGrowId}/skill/${skillId}.png`

                // 等级描述替换
                let levelDesc = ""
                if (data.levelInfo?.optionDesc && base.optionValue) {
                    levelDesc = data.levelInfo.optionDesc
                    for (const key in base.optionValue) {
                        levelDesc = levelDesc.replace(
                            `{${key}}`,
                            base.optionValue[key]
                        )
                    }
                }

                return {
                    skillId,
                    name: data.name,
                    desc: data.desc,

                    requiredLevel: data.requiredLevel,
                    requiredLevelRange: data.requiredLevelRange,
                    maxLevel: data.maxLevel,

                    castingTime: base.castingTime,
                    coolTime: base.coolTime,
                    consumeMp: base.consumeMp,

                    levelDesc,
                    icon
                }
            }

        }

    }).mount("#app")
</script>

</html>